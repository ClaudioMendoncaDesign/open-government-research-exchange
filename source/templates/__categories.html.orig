{% extends '_base.html' %}

<<<<<<< HEAD
{%- macro getFilterOptions(field, category, isArray=false, num=1, prefix=false) -%}
  {%- set results = "" -%}
  {%- set delimiter = "!@#$%^*()" -%}
  {%- for d in $global.papers -%}
    {%- set _match = false -%}
    {%- for i in d.taxonomy.category -%}
      {%- if i == category -%}
       {%- set _match = true -%}
      {%- endif -%}
    {%- endfor -%}
    {%- if _match -%}
      {%- if prefix -%}
        {%- set v = d[prefix][field | slug] -%}
      {% else %}
        {%- set v = d[field | slug] -%}
      {%- endif -%}
      {%- if v -%}
        {%- if isArray -%}
          {%- for j in v -%}
            {%- set x_match = false -%}
            {%- for x in results | split(delimiter) -%}
              {%- if x == j -%}
               {%- set x_match = true -%}
              {%- endif -%}
            {%- endfor -%}
            {%- if x_match == false -%}
              {%- if results == "" -%}
                {%- set results = j -%}
              {%- else -%}
                {%- set results = results + delimiter + j -%}
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
        {%- else -%}
          {%- set y_match = false -%}
          {%- for y in results | split(delimiter) -%}
            {%- if y == v -%}
             {%- set y_match = true -%}
            {%- endif -%}
          {%- endfor -%}
          {%- if y_match == false -%}
            {%- if results == "" -%}
              {%- set results = v -%}
            {%- else -%}
              {%- set results = results + delimiter + v -%}
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}
  {%- set results = results | split(delimiter) %}
  <div class="b-filter-ui-container">
    <div class="large-2 columns">
      <div class="e-select">
        <select name="" id="" class="b-filter js-change" {% if results | length == 0 %}disabled{% endif %}>
          <option data-filter="{% for n in range(num) %}*{% endfor %}">{{field}}</option>
          {% for r in results -%}
            <option data-filter="f-{{r | slug}}">{{r}}</option>
          {%- endfor %}
        </select>
      </div>
    </div>
  </div>
{%- endmacro -%}

=======
>>>>>>> 8f4b09ad57083a2a9c6ccf54a0860ac0104e7985
{% block main %}
<div class="b-categories-page">
  <div class="b-filter-ui js-and">
    <div class="b-top-section m-{{title | slug}}">
      <div class="row">
        <div class="large-12 column">
          <h1>{{ title }}</h1>
          <h3 class="e-tagline">{{description}}</h3>
        </div>
        <span class="b-filter-ui-container js-multi">
          <div class="switch">
            <label>
              All Articles
              <input type="checkbox" class="b-filter" data-filter="f-open">
              <span class="lever"></span>
              Free Articles Only
            </label>
          </div>
        </span>
      </div>
    </div>
    <div class="b-divider b-filter-panel m-black">

      <h2>Filters</h2>

<<<<<<< HEAD
        </form>
      </div>
=======
      {% for name, filters in $global.filters %}
        {% if name == custom_filter|slug %}
          <div class="row">
            <form action="#" class="b-form">
              <div class="b-filter-ui-container">
                <div class="large-2 columns">
                  <div class="e-select">
                    <select name="" id="" class="b-filter js-change"{% if filters.organizations | length == 0 %} disabled{% endif %}>
                      <option data-filter="*">Organizations</option>
                      {% for item in filters.organizations %}
                        <option data-filter="f-{{ item | slug }}">{{ item }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="b-filter-ui-container">
                <div class="large-2 columns">
                  <div class="e-select">
                    <select name="" id="" class="b-filter js-change"{% if filters.objectives | length == 0 %} disabled{% endif %}>
                      <option data-filter="**">Objective</option>
                      {% for item in filters.objectives %}
                        <option data-filter="f-{{ item | slug }}">{{ item }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="b-filter-ui-container">
                <div class="large-2 columns">
                  <div class="e-select">
                    <select name="" id="" class="b-filter js-change"{% if filters.methodologies | length == 0 %} disabled{% endif %}>
                      <option data-filter="***">Methodology</option>
                      {% for item in filters.methodologies %}
                        <option data-filter="f-{{ item | slug }}">{{ item }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="b-filter-ui-container">
                <div class="large-2 columns">
                  <div class="e-select">
                    <select name="" id="" class="b-filter js-change"{% if filters.sectors | length == 0 %} disabled{% endif %}>
                      <option data-filter="*****">Sector</option>
                      {% for item in filters.sectors %}
                        <option data-filter="f-{{ item | slug }}">{{ item }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="b-filter-ui-container">
                <div class="large-2 columns">
                  <div class="e-select">
                    <select name="" id="" class="b-filter js-change"{% if filters.regions | length == 0 %} disabled{% endif %}>
                      <option data-filter="*****">Region</option>
                      {% for item in filters.regions %}
                        <option data-filter="f-{{ item | slug }}">{{ item }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="b-filter-ui-container">
                <div class="large-2 columns">
                  <div class="e-select">
                    <select name="" id="" class="b-filter js-change"{% if filters.types | length == 0 %} disabled{% endif %}>
                      <option data-filter="******">Type</option>
                      {% for item in filters.types %}
                        <option data-filter="f-{{ item | slug }}">{{ item }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>
            </form>
          </div>
        {% endif %}
      {% endfor %}
>>>>>>> 8f4b09ad57083a2a9c6ccf54a0860ac0104e7985
    </div>
  </div>

  <div class="b-page-section b-results-section b-isotope">
    {% for d in $global.papers %}

<<<<<<< HEAD
    {%- set _match = false -%}
    {%- for i in d.taxonomy.category -%}
      {%- if i == custom_filter -%}
        {%- set _match = true -%}
      {%- endif -%}
    {%- endfor -%}
=======
    {% set _match = false %}

    {% for i in d.taxonomy.category %}

    {% if i == custom_filter %}
      {% set _match = true %}
    {% endif %}

    {% endfor %}
>>>>>>> 8f4b09ad57083a2a9c6ccf54a0860ac0104e7985

    {% if _match %}
    <div class="b-result-item m-access-{{d.access | slug}} f-{{d.organization | slug}} f-{{d.taxonomy.objective | slug}} f-{{d.access | slug}} f-{{d.taxonomy.methodology | slug}} f-{{d.sector | slug}} f-{{d.sector | slug}} f-{{d.region | slug}} f-{{d.sector | slug}} f-{{d.type | slug}} {% for c in d.taxonomy.category %} m-{{ c | slug}}{% endfor %} ">


      <a href="{{d.id}}-{{d.title | slug}}.html" title="{{d.title}}">
        {# {% if d.cover_image %}
        <div class="e-result-image" style="background-image: url('{{d.cover_image}}')"></div>
        {% endif %} #}



        <h3 class="e-result-name">{{d.title}}</h3>

        {% if d.authors %}
        <p class="e-result-authors">
          {% for author in d.authors %}
            {{ author }}{% if not loop.last %},{% endif %}
          {% endfor %}
        </p>
        {% endif %}


        <!-- These IF statements are not really working.  -->

        {% if d.taxonomy.category %}
        <div class="e-result-taxonomy m-category">
          <p>Category</p>
          {% for cat in d.taxonomy.category %} <span class="m-{{cat}}">{{cat}}</span> {% endfor %}
        </div>
        {% endif %}

        {% if d.taxonomy.methodology %}
        <div class="e-result-taxonomy m-methodology">
          <p>Methodology</p>
          {% for met in d.taxonomy.methodology %} <span>{{met}}</span> {% endfor %}
        </div>
        {% endif %}

        {% if d.taxonomy.objective %}
        <div class="e-result-taxonomy m-objective">
          <p>Objective</p>
          {% for obj in d.taxonomy.objective %} <span>{{obj}}</span> {% endfor %}</div>
        {% endif %}

          <div class="e-result-extras m-{{d.organization | slug }}">
            {% if d.organization == "the-govlab" %}
              <img class="e-organization-logo" src="img/organizations/govlab-logo-white.png" alt="The GovLab">
            {% elif d.organization == "mysociety" %}
              <img class="e-organization-logo" src="img/organizations/mysociety-logo-white.png" alt="mySociety">
            {% elif d.organization == "world-bank-digital-engagement-evaluation-team" %}
              <img class="e-organization-logo" src="img/organizations/deet-logo-white.png" alt="Digital Engagement Evaluation Team">
            {% endif %}

            {% if d.github %} <img class="e-github-logo" src="img/github-logo.svg" alt=""> {% endif %}
            {% if d.datasets %} <i class="material-icons" title="Datasets">file_download</i>{% endif %}
            {% if d.access == "Closed" %} <i class="material-icons m-closed-access" title="Closed Access">lock_outline</i>{% endif %}
          </div>
        </a>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endblock %}
